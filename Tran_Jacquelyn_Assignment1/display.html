<!DOCTYPE html>
<html>
<script>
    function isNonNegInt(stringValue, returnErrors = false) { //checks valid integer
        if (stringValue == "") stringValue = 0;
        errors = []; // borrowed from lab12
        if (Number(stringValue) != stringValue) 
        errors.push('<font color="red">Not a number!</font>'); //number value
        if (stringValue < 0) 
        errors.push('<font color="red">Negative value!</font>'); //non-negative
        if (parseInt(stringValue) != stringValue) 
        errors.push('<font color="red">Not an integer!</font>'); //integer

        return returnErrors ? errors : (errors.length == 0); //error array
    }

    function checkQuantityTextbox(qtyTextboxObj) {
        errs = isNonNegInt(qtyTextboxObj.value, true); //if non negative integer, then data is valid
        if (errs.length == 0) errs = ['Quantity:']; //when typing in the textbox, this will display 
        if (qtyTextboxObj.value.trim() == '') errs = ['Quantity:'];
        document.getElementById(qtyTextboxObj.name + '_label').innerHTML = errs.join(", ");
    }

    var params = (new URL(document.location)).searchParams;
    if (param.has('quantity_textbox')) {
        quantity_form['quantity_textbox'].value = params.get('quantity_textbox');
        checkQuantityTextbox(quantity_form['quantity_textbox']);
    }

    window.onload = function () {
        if (params.has('quantity_textbox')) {
            if (isNonNegInt(params.get('quantity_textbox'))) { //asks if quantity is valid
                document.body.innerHTML(`Thank for you for ordering ${params.get('quantity_textbox')} things!`);
            } else {
                window.location.href = display.html 
            }
        }
    }
</script>

<head>
    <meta charset="utf-8">
    <title>Smart Phone Store</title>

    <link href="https://fonts.googleapis.com/css?family=Cherry+Swash|Raleway" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <script src="./products_data.js"></script>

</head>

<body>

    <header>
        <h1>Matcha Madness</h1>
    </header>

    <div>
        <form name="quantity_form" action="./invoice.html" method="GET">
            <main>
                <script>
                    //loop prints products, info, quantity
                    for (var i = 0; i <= 5; i++) {
                        document.write(`
                            <section class="item">
                            <h2>${products[i].name}</h2>
                            <p> &dollar; ${products[i].price}</p>
                            <img src=${products[i].image}>
                            <label id='quantity_textbox_label'>${`Quantity:`}</label>
                            <input name='quantity_textbox' type="text" placeholder="0" onkeyup="checkQuantityTextbox(this);">
                            </section>
                            `);
                    }
                </script>
            </main>
    </div>
    <input type="submit" value=Purchase onclick="displayPurchase();" name="purchase_submit">
    </form>
    <footer>
    </footer>
</body>

</html>